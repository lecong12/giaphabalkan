<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Gia Phả Lê Công - Bản Không Giới Hạn</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/orgchart/3.1.1/css/jquery.orgchart.min.css">
    <style>
        html, body { width: 100%; height: 100%; margin: 0; padding: 0; font-family: Arial, sans-serif; background: #f8f9fa; }
        #chart-container { width: 100%; height: 100%; overflow: auto; text-align: center; }
        .orgchart { background: transparent; }
        .orgchart .node .title { background-color: #0066cc; } /* Màu cho nam */
        .orgchart .node .content { border: 1px solid #0066cc; }
    </style>
</head>
<body>
    <div id="chart-container"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/orgchart/3.1.1/js/jquery.orgchart.min.js"></script>
    <script>
        const SHEET_ID = '19ON0r9hn0Z6VcuM9oeeKyaCP863tkZlqeV3Si3v25KE';
        const SHEET_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=Data`;

        async function init() {
            const res = await fetch(SHEET_URL);
            const text = await res.text();
            const lines = text.split('\n');
            const data = [];
            
            // Đọc dữ liệu từ Sheets
            for(let i=1; i<lines.length; i++) {
                const cols = lines[i].replace(/"/g, "").split(',');
                if(cols[0]) {
                    data.push({
                        id: cols[0].trim(),
                        pid: cols[1].trim() === "0" ? null : cols[1].trim(),
                        name: cols[3].trim()
                    });
                }
            }

            // Chuyển danh sách phẳng sang cấu trúc phân cấp (Tree)
            const listToTree = (data) => {
                let map = {}, node, roots = [], i;
                for (i = 0; i < data.length; i++) {
                    map[data[i].id] = i; 
                    data[i].children = []; 
                }
                for (i = 0; i < data.length; i++) {
                    node = data[i];
                    if (node.pid !== null && map[node.pid] !== undefined) {
                        data[map[node.pid]].children.push(node);
                    } else {
                        roots.push(node);
                    }
                }
                return roots[0];
            };

            const datascource = listToTree(data);

            $('#chart-container').orgchart({
                'data' : datascource,
                'nodeContent': 'name',
                'pan': true,
                'zoom': true
            });
        }
        init();
    </script>
</body>
</html>
